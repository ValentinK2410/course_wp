# Инструкция по диагностике проблемы с регистрацией

## Проблема
Пользователь не создается в Moodle, логи не записываются.

## Шаги диагностики

### 1. Проверка файла логирования

После обновления плагина (`git pull`) проверьте следующие файлы:

#### Файл 1: `wp-content/course-registration-debug.log`
Этот файл должен создаваться автоматически при инициализации класса и при каждом AJAX-запросе.

**Проверьте:**
- Существует ли файл?
- Если нет - проблема в правах доступа к папке `wp-content/`
- Если да - пришлите его содержимое

#### Файл 2: `wp-content/course-registration-error.log`
Создается, если не удается записать в основной файл логирования.

**Проверьте:**
- Существует ли этот файл?
- Если да - проблема в правах доступа

### 2. Проверка прав доступа

Выполните на сервере:
```bash
# Проверьте права на папку wp-content
ls -la wp-content/

# Установите права на запись (если нужно)
chmod 755 wp-content/
chmod 644 wp-content/course-registration-debug.log
```

### 3. Проверка AJAX-запроса в браузере

1. Откройте страницу с формой регистрации
2. Откройте консоль разработчика (F12)
3. Перейдите на вкладку "Network" (Сеть)
4. Заполните форму и отправьте
5. Найдите запрос к `admin-ajax.php`
6. Проверьте:
   - Отправляется ли запрос?
   - Какой статус ответа (200, 404, 500)?
   - Что в теле ответа?

### 4. Проверка инициализации класса

В файле `wp-content/course-registration-debug.log` должны быть записи:
```
[YYYY-MM-DD HH:MM:SS] Course_Registration: КЛАСС ИНИЦИАЛИЗИРОВАН!
[YYYY-MM-DD HH:MM:SS] Course_Registration: AJAX обработчики зарегистрированы
```

Если этих записей нет - класс не инициализируется.

### 5. Проверка вызова AJAX-обработчика

При отправке формы в файле `wp-content/course-registration-debug.log` должна появиться запись:
```
[YYYY-MM-DD HH:MM:SS] ========== AJAX ОБРАБОТЧИК ВЫЗВАН! ==========
```

Если этой записи нет - AJAX-запрос не доходит до сервера или обработчик не вызывается.

### 6. Проверка настроек WordPress

Убедитесь, что:
- Регистрация пользователей включена: Настройки → Общие → "Членство: Любой может зарегистрироваться"
- Плагин активирован
- Нет конфликтов с другими плагинами

### 7. Проверка настроек Moodle

Убедитесь, что в настройках плагина (Курсы Про → Moodle Sync) указаны:
- Moodle URL: `https://class.dekan.pro`
- Moodle Token: установлен
- Синхронизация пользователей: включена

## Что прислать для диагностики

1. Содержимое файла `wp-content/course-registration-debug.log` (если существует)
2. Содержимое файла `wp-content/course-registration-error.log` (если существует)
3. Скриншот консоли браузера (вкладка Network) при отправке формы
4. Скриншот ответа от `admin-ajax.php` (вкладка Response)
5. Результат команды `ls -la wp-content/` (права доступа)

## Быстрая проверка

Выполните на сервере:
```bash
# Проверьте, создается ли файл логирования
touch wp-content/course-registration-debug.log
chmod 666 wp-content/course-registration-debug.log

# Проверьте логи WordPress (если WP_DEBUG включен)
tail -f wp-content/debug.log
```

Затем попробуйте зарегистрировать пользователя и проверьте, появились ли записи в файлах.


















