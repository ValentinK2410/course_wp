# Инструкция по проверке логов синхронизации с Moodle

## Где находятся логи

Логи плагина сохраняются в директории загрузок WordPress:
```
wp-content/uploads/course-plugin-logs/sync-YYYY-MM-DD.log
```

Например:
- `wp-content/uploads/course-plugin-logs/sync-2025-12-19.log` - логи за 19 декабря 2025 года

## Как проверить логи

### Вариант 1: Через FTP/SSH

1. Подключитесь к серверу по FTP или SSH
2. Перейдите в директорию `wp-content/uploads/course-plugin-logs/`
3. Откройте файл с текущей датой (например, `sync-2025-12-19.log`)
4. Просмотрите последние записи

### Вариант 2: Через файловый менеджер хостинга

1. Войдите в панель управления хостингом
2. Откройте файловый менеджер
3. Перейдите в `wp-content/uploads/course-plugin-logs/`
4. Откройте файл с текущей датой

### Вариант 3: Через WordPress (если есть доступ к файлам)

1. Войдите в админ-панель WordPress
2. Используйте плагин для просмотра файлов или FTP-клиент
3. Перейдите в `wp-content/uploads/course-plugin-logs/`

## Что искать в логах

### Успешная синхронизация

Ищите записи:
```
[2025-12-19 12:00:00] [INFO] ========== НАЧАЛО РЕГИСТРАЦИИ ==========
[2025-12-19 12:00:00] [INFO] Попытка синхронизации пользователя ID: X, логин: test_user
[2025-12-19 12:00:00] [INFO] Пароль из формы (длина): X символов
[2025-12-19 12:00:00] [INFO] Пароль сохранен в глобальную переменную для логина: test_user
[2025-12-19 12:00:00] [INFO] Класс Course_Moodle_User_Sync найден
[2025-12-19 12:00:00] [INFO] ========== НАЧАЛО СИНХРОНИЗАЦИИ ==========
[2025-12-19 12:00:01] [INFO] УСПЕХ! Пользователь успешно создан в Moodle (ID: X)
```

### Ошибки синхронизации

Ищите записи с `[ERROR]`:
```
[2025-12-19 12:00:00] [ERROR] URL или токен не настроены
[2025-12-19 12:00:00] [ERROR] Синхронизация вернула false
[2025-12-19 12:00:00] [ERROR] ОШИБКА от Moodle API - Invalid parameter value detected
```

## Частые проблемы и решения

### Проблема: Логи не создаются

**Решение:**
1. Проверьте права доступа к директории `wp-content/uploads/`
2. Убедитесь, что директория `course-plugin-logs` существует и доступна для записи
3. Проверьте, что плагин активирован

### Проблема: Пользователь не создается в Moodle

**Проверьте в логах:**
1. Вызывается ли синхронизация? (ищите "НАЧАЛО РЕГИСТРАЦИИ")
2. Передается ли пароль? (ищите "Пароль сохранен")
3. Настроены ли URL и токен? (ищите "Настройки - URL:")
4. Есть ли ошибки от Moodle API? (ищите "[ERROR]")

**Возможные причины:**
- URL или токен Moodle не настроены
- Токен не имеет прав на создание пользователей
- Пароль не соответствует требованиям Moodle (нужен специальный символ)
- Ошибка сети при подключении к Moodle

### Проблема: Пароль не передается

**Проверьте в логах:**
- Есть ли запись "Пароль из формы (длина): X символов"?
- Есть ли запись "Пароль сохранен в глобальную переменную"?
- Есть ли запись "Пароль найден в глобальной переменной"?

**Если пароль не найден:**
- Проверьте, что форма регистрации использует правильные поля
- Убедитесь, что плагин обновлен до последней версии

## Включение стандартного логирования WordPress

Если вы хотите также использовать стандартное логирование WordPress (`wp-content/debug.log`), добавьте в файл `wp-config.php`:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

**Важно:** После отладки отключите `WP_DEBUG` для безопасности!

## Контакты для поддержки

Если проблема не решена после проверки логов, пришлите:
1. Последние 50 строк из файла лога
2. Описание проблемы
3. Шаги для воспроизведения проблемы

