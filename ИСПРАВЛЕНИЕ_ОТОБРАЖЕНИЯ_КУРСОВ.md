# Исправление отображения курсов на странице /courses/

## Проблема
Страница https://mbs.russianseminary.org/courses/ не отображает курсы.

## Причина
Код плагина проверял только URL `/course/` (единственное число), но на сайте используется URL `/courses/` (множественное число).

## Исправления
Обновлены проверки URL в следующих файлах:
1. `course-plugin/includes/class-course-frontend.php` - добавлена поддержка `/courses/`
2. `course-plugin/templates/archive-course.php` - добавлена поддержка `/courses/`

Теперь код поддерживает оба варианта URL:
- `/course/`
- `/courses/`

## Что нужно сделать после обновления

### 1. Сбросить правила перезаписи URL (rewrite rules)

**Вариант 1: Через админ-панель WordPress**
1. Войдите в админ-панель WordPress
2. Перейдите в **Настройки → Постоянные ссылки**
3. Нажмите кнопку **Сохранить изменения** (не нужно ничего менять, просто сохраните)

**Вариант 2: Через код (временный файл)**
Создайте файл `reset-rewrite-rules.php` в корне WordPress:

```php
<?php
require_once('wp-load.php');
flush_rewrite_rules();
echo "Rewrite rules сброшены!";
```

Откройте файл в браузере: `https://mbs.russianseminary.org/reset-rewrite-rules.php`
После этого удалите файл.

### 2. Проверить, что курсы опубликованы

1. Войдите в админ-панель WordPress
2. Перейдите в **Курсы Про → Все курсы**
3. Убедитесь, что есть опубликованные курсы (статус "Опубликовано")
4. Если курсы в статусе "Черновик" или "В ожидании", опубликуйте их

### 3. Проверить работу страницы

1. Откройте страницу https://mbs.russianseminary.org/courses/
2. Убедитесь, что курсы отображаются
3. Если курсы не отображаются, проверьте:
   - Есть ли опубликованные курсы в базе данных
   - Правильно ли настроены постоянные ссылки
   - Нет ли конфликтов с другими плагинами или темой

## Дополнительная диагностика

Если проблема сохраняется, проверьте:

1. **Логи ошибок WordPress**
   - Включите `WP_DEBUG` в `wp-config.php`
   - Проверьте файл `wp-content/debug.log`

2. **Проверка запроса курсов**
   Создайте временный файл `test-courses.php` в корне WordPress:

```php
<?php
require_once('wp-load.php');

$courses = get_posts(array(
    'post_type' => 'course',
    'post_status' => 'publish',
    'posts_per_page' => -1,
));

echo '<h1>Найдено курсов: ' . count($courses) . '</h1>';

if (!empty($courses)) {
    echo '<ul>';
    foreach ($courses as $course) {
        echo '<li><a href="' . get_permalink($course->ID) . '">' . $course->post_title . '</a></li>';
    }
    echo '</ul>';
} else {
    echo '<p>Курсы не найдены. Проверьте, что есть опубликованные курсы.</p>';
}
```

Откройте файл в браузере для проверки.

3. **Проверка архива курсов**
   Проверьте, что функция `is_post_type_archive('course')` работает правильно.

## Технические детали

### Изменения в коде

1. **class-course-frontend.php**
   - Обновлена проверка URL для поддержки `/course/` и `/courses/`
   - Добавлена поддержка пагинации (`/courses/page/2/`)
   - Улучшена обработка query string в URL

2. **archive-course.php**
   - Обновлена проверка URL для поддержки `/course/` и `/courses/`
   - Добавлена поддержка пагинации

### Регулярное выражение

Используется регулярное выражение: `#/(course|courses)(/page/\d+)?/?$#`

Оно поддерживает:
- `/course/`
- `/courses/`
- `/course/page/2/`
- `/courses/page/2/`

## Контакты

Если проблема не решена, обратитесь к разработчику плагина.
