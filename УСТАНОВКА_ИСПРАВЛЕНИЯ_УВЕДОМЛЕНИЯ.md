# Установка исправления уведомления miniorange-login-openid

## Проблема

На странице плагинов (`/wp-admin/plugins.php`) и других страницах админ-панели появляется уведомление:

```
Notice: Function _load_textdomain_just_in_time was called incorrectly. 
Translation loading for the miniorange-login-openid domain was triggered too early. 
This is usually an indicator for some code in the plugin or theme running too early. 
Translations should be loaded at the init action or later.
```

## Решение

Создан специальный плагин для автоматического исправления этой проблемы.

### Способ 1: Установка как обычный плагин (рекомендуется)

1. **Скопируйте файл** `fix-miniorange-translation-notice.php` из папки `course-plugin` в папку `wp-content/plugins/` вашего WordPress сайта

2. **Активируйте плагин**:
   - Перейдите в **Плагины → Установленные плагины**
   - Найдите плагин "Исправление уведомления miniorange-login-openid"
   - Нажмите **Активировать**

3. **Проверьте результат**:
   - Обновите страницу плагинов
   - Уведомление должно исчезнуть

### Способ 2: Установка как Must-Use плагин (автоматическая активация)

Must-Use плагины автоматически активируются и не могут быть деактивированы через админ-панель.

1. **Создайте папку** `mu-plugins` в `wp-content/`, если её нет:
   ```bash
   mkdir -p /var/www/www-root/data/www/mbs.russianseminary.org/wp-content/mu-plugins
   ```

2. **Скопируйте файл** `fix-miniorange-translation-notice.php` в папку `wp-content/mu-plugins/`

3. **Проверьте результат**:
   - Обновите страницу плагинов
   - Уведомление должно исчезнуть
   - Плагин будет автоматически активен

### Способ 3: Добавление в functions.php темы (альтернатива)

Если вы не хотите создавать отдельный плагин, добавьте этот код в `functions.php` активной темы:

```php
/**
 * Исправление уведомления miniorange-login-openid
 */
add_filter('doing_it_wrong_trigger_error', function($trigger, $function_name, $message) {
    if ($function_name === '_load_textdomain_just_in_time') {
        if (is_string($message) && strpos($message, 'miniorange-login-openid') !== false) {
            return false;
        }
    }
    return $trigger;
}, 10, 3);
```

**Внимание:** Этот способ менее надежен, так как зависит от темы. При смене темы код нужно будет добавить снова.

## Проверка работы

После установки:

1. Откройте страницу **Плагины** (`/wp-admin/plugins.php`)
2. Убедитесь, что уведомление исчезло
3. Проверьте другие страницы админ-панели

## Что делает плагин

Плагин использует фильтр WordPress `doing_it_wrong_trigger_error` для подавления конкретного уведомления о ранней загрузке переводов плагина `miniorange-login-openid`.

**Важно:**
- Плагин подавляет только это конкретное уведомление
- Все остальные уведомления WordPress продолжают работать
- Это не влияет на функциональность сайта или плагина miniorange-login-openid

## Удаление

Если вы хотите удалить исправление:

**Для обычного плагина:**
- Перейдите в **Плагины → Установленные плагины**
- Найдите плагин "Исправление уведомления miniorange-login-openid"
- Нажмите **Деактивировать** и затем **Удалить**

**Для Must-Use плагина:**
- Удалите файл `fix-miniorange-translation-notice.php` из папки `wp-content/mu-plugins/`

**Для functions.php:**
- Удалите добавленный код из `functions.php` темы

## Технические детали

### Почему возникает уведомление?

WordPress 6.7.0 добавил проверку, которая предупреждает, когда переводы загружаются слишком рано (до хука `init`). Это помогает разработчикам плагинов писать более качественный код.

Плагин `miniorange-login-openid` загружает переводы при инициализации плагина, что происходит до хука `init`. Это не критическая ошибка, но WordPress предупреждает об этом.

### Как работает исправление?

Фильтр `doing_it_wrong_trigger_error` позволяет контролировать, какие уведомления о неправильном использовании функций будут показаны. Мы проверяем:
1. Что это уведомление о функции `_load_textdomain_just_in_time`
2. Что сообщение относится к домену `miniorange-login-openid`
3. Если оба условия выполнены, подавляем уведомление

## Альтернативные решения

Если вы хотите исправить проблему в самом плагине `miniorange-login-openid`:

1. Найдите файл плагина, где вызывается `load_plugin_textdomain()` или `load_textdomain()`
2. Оберните вызов в хук `init`:

```php
// Было:
load_plugin_textdomain('miniorange-login-openid', false, dirname(plugin_basename(__FILE__)) . '/languages');

// Стало:
add_action('init', function() {
    load_plugin_textdomain('miniorange-login-openid', false, dirname(plugin_basename(__FILE__)) . '/languages');
});
```

**Внимание:** Изменения будут потеряны при обновлении плагина.

## Контакты

Если у вас возникли проблемы с установкой или работой исправления, обратитесь к разработчику.
