# Настройка защиты от ботов

## Что реализовано

Многоуровневая защита от ботов для формы регистрации:

1. **Honeypot поле** - скрытое поле, которое заполняют только боты (всегда включено)
2. **Проверка времени заполнения** - форма должна заполняться минимум 2 секунды (всегда включено)
3. **Google reCAPTCHA v3** - невидимая проверка от Google (требует настройки)
4. **Rate Limiting** - ограничение попыток регистрации с одного IP адреса (настраивается)

## Настройка

### Шаг 1: Включение защиты

1. Войдите в админку WordPress: `https://site.dekan.pro/wp-admin`
2. Перейдите в: **Курсы Про → Защита от ботов**
3. Убедитесь, что включена опция **"Включить защиту от ботов"**

### Шаг 2: Настройка Google reCAPTCHA v3 (опционально, но рекомендуется)

1. Перейдите на [Google reCAPTCHA Admin Console](https://www.google.com/recaptcha/admin)
2. Нажмите **"+ Create"** для создания нового сайта
3. Выберите **reCAPTCHA v3**
4. Добавьте домены:
   - `site.dekan.pro`
   - `www.site.dekan.pro` (если используется)
5. Скопируйте **Site Key** и **Secret Key**
6. Вставьте их в настройки WordPress:
   - **Site Key** → поле "Site Key"
   - **Secret Key** → поле "Secret Key"
7. Сохраните настройки

### Шаг 3: Настройка Rate Limiting

1. В разделе **"Ограничение попыток регистрации"**:
   - **Максимум попыток**: количество попыток регистрации за период (по умолчанию: 5)
   - **Период (в секундах)**: период времени для подсчета попыток (по умолчанию: 3600 = 1 час)

## Как это работает

### Honeypot поле
- Скрытое поле добавляется автоматически в форму регистрации
- Боты обычно заполняют все поля, включая скрытые
- Если поле заполнено, регистрация блокируется

### Проверка времени заполнения
- Отслеживается время от первого клика до отправки формы
- Если форма заполнена быстрее 2 секунд, регистрация блокируется
- Это защищает от автоматических ботов, которые заполняют формы мгновенно

### Google reCAPTCHA v3
- Работает в фоновом режиме, не требует действий от пользователя
- Анализирует поведение пользователя и присваивает рейтинг (score) от 0.0 до 1.0
- Если рейтинг ниже 0.5, регистрация блокируется
- Не мешает реальным пользователям

### Rate Limiting
- Отслеживает количество попыток регистрации с одного IP адреса
- Если превышен лимит, регистрация блокируется на указанный период
- Защищает от массовых регистраций

## Рекомендуемые настройки

### Для обычных сайтов:
- **reCAPTCHA v3**: Включена
- **Rate Limiting**: Включен
- **Максимум попыток**: 5
- **Период**: 3600 секунд (1 час)

### Для сайтов с высокой нагрузкой:
- **reCAPTCHA v3**: Включена
- **Rate Limiting**: Включен
- **Максимум попыток**: 10
- **Период**: 1800 секунд (30 минут)

### Для тестирования:
- **reCAPTCHA v3**: Можно отключить (но не рекомендуется для продакшена)
- **Rate Limiting**: Можно отключить (но не рекомендуется для продакшена)
- Honeypot и проверка времени всегда работают

## Проверка работы

1. Попробуйте зарегистрироваться как обычный пользователь - должно работать нормально
2. Попробуйте заполнить форму слишком быстро (< 2 секунд) - должна быть заблокирована
3. Попробуйте заполнить honeypot поле (через консоль браузера) - должна быть заблокирована
4. Попробуйте зарегистрироваться несколько раз подряд с одного IP - после лимита должна быть заблокирована

## Логирование

Все попытки блокировки логируются:
- WordPress логи: `wp-content/debug.log`
- Логи плагина: `wp-content/uploads/course-plugin-logs/sync-YYYY-MM-DD.log`
- Логи регистрации: `wp-content/course-registration-debug.log`

Ищите строки с `Course Anti-Bot:` для информации о блокировках.

## Troubleshooting

### Проблема: "Обнаружена автоматическая регистрация"
- **Причина**: Honeypot поле было заполнено
- **Решение**: Убедитесь, что вы не используете автоматическое заполнение форм

### Проблема: "Форма заполнена слишком быстро"
- **Причина**: Форма была отправлена менее чем за 2 секунды
- **Решение**: Заполните форму внимательно, не торопитесь

### Проблема: "Превышен лимит попыток регистрации"
- **Причина**: Слишком много попыток регистрации с одного IP
- **Решение**: Подождите указанное время или обратитесь к администратору

### Проблема: "Ошибка проверки безопасности" (reCAPTCHA)
- **Причина**: reCAPTCHA не настроена или ключи неверны
- **Решение**: Проверьте настройки reCAPTCHA в админке WordPress

## Безопасность

- Все методы защиты работают независимо друг от друга
- Даже если один метод не сработает, другие продолжат защищать
- Rate limiting использует WordPress transients (временное хранилище)
- reCAPTCHA проверяется через официальный API Google
- Honeypot поле полностью скрыто от пользователей

